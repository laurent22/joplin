<!DOCTYPE html>
<html lang="en">

<!--

!!! WARNING !!!

This file was auto-generated from readme/news/20200906-172325.md and any manual change
made to it will be overwritten. To make a change to this file please modify
the source Markdown file:

https://github.com/laurent22/joplin/blob/dev/readme/news/20200906-172325.md

-->

	<head>
<!-- Donate button A/B testing -->

<!--
<script async src="https://www.googleoptimize.com/optimize.js?id=OPT-PW3ZPK3"></script>
-->		<meta
			charset="utf-8"
			http-equiv="X-UA-Compatible"
			content="IE=edge,chrome=1"
		/>
		<link rel="icon" href="&#x2F;images/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#000000" />
		<meta name="description" content="Joplin, the open source note-taking application" />
		<link
			rel="stylesheet"
			href="&#x2F;css/bootstrap5.0.2.min.css"
			as="style"
		/>
		<link rel="stylesheet" href="/css/fontawesome-all.min.css?h=ecd507b3125edc4d2a03aa6ae5d07da9">
		<link
			href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
			rel="stylesheet"
			as="style"
			media="all"
			onload="this.media='all'; this.onload = null"
		/>
		<link rel="stylesheet" href="/css/site.css?h=7ac82e1f40a384f69c644263acc99fc8" as="style" />
		<title>Improving the sync process in Joplin | Joplin</title>

		<script
			src="&#x2F;js/jquery-3.6.0.min.js"
			rel="preload"
			as="script"
		></script>
	</head>
	<body class="website-env-prod">
		<div class="container-fluid generic-template -page" id="main-container">

<div class=" navbar-main white-bg" id="nav-section">
	<div class="container">
		<div class="row">
			<div class="col-3">
				<a href="/">
					<img
						src="&#x2F;images/logo-text-blue.svg"
						alt=""
						id="top-logo"
						width="180"
					/>
				</a>
			</div>
			<div class="col-9 text-right d-none d-md-block">
				<a href="/news/" class="fw500">What's New</a>
				<a href="/help/" class="fw500">Help</a>
				<a href="https:&#x2F;&#x2F;discourse.joplinapp.org&#x2F;" class="fw500">Forum</a>
<a href="/plans/" class="button-link btn-trans plans-button">Joplin Cloud</a><a class="button-link btn-blue sponsor-button" href="/donate">
	<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i>&nbsp;Support us
</a>			</div>
			<div class="col-9 text-right d-block d-md-none navbar-mobile-content">
<a class="button-link btn-blue sponsor-button" href="/donate">
	<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i>&nbsp;Support us
</a>
				<span class="pointer"
					><img
						src="&#x2F;images/mobile-menu-black-open-icon.png"
						id="open-menu-mobile"
						alt=""
				/></span>
				&nbsp;&nbsp;

				<div id="menu-mobile">
					<div>
						<div class="text-right">
							<img
								src="&#x2F;images/close-icon.png"
								alt=""
								class="pointer"
								id="close-menu-mobile"
							/>
						</div>

						<div class="text-center menu-mobile-top">
							<a href="/news/" class="fw500 mobile-menu-link">What's New</a>
							<a href="/help/" class="fw500 mobile-menu-link">Help</a>
							<a href="https:&#x2F;&#x2F;discourse.joplinapp.org&#x2F;" class="fw500 mobile-menu-link">Forum</a>
						</div>

						<div class="menu-mobile-buttons">
<a href="/plans/" class="button-link btn-trans plans-button">Joplin Cloud</a><a class="button-link btn-blue sponsor-button" href="/donate">
	<i class="fas fa-heart heart-full"></i><i class="far fa-heart heart-line"></i>&nbsp;Support us
</a>						</div>
					</div>

					
					<div>
						<p class="light-blue mobile-menu-link-bottom text-center">
							Copyright &copy; 2016-2021 Laurent&nbsp;Cozic
							<br/>
							<a href="/privacy/" class="fw500">Privacy Policy</a>
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
			<div class="help-page-container page-20200906-172325">
				<div class="container">
					<div class="row content-wrapper">
						

						<div class="main-content">
							<div class="alert alert-danger alert-env-dev" role="alert">
								Running in prod mode!
							</div>
							<div class="donate-links">
<p><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=E8JMYD2LQ8MMA&amp;lc=GB&amp;item_name=Joplin+Development&amp;currency_code=EUR&amp;bn=PP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Donate-PayPal-green.svg" alt="Donate using PayPal"></a> <a href="https://github.com/sponsors/laurent22/"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/GitHub-Badge.svg" alt="Sponsor on GitHub"></a> <a href="https://www.patreon.com/joplin"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Patreon-Badge.svg" alt="Become a patron"></a> <a href="https://joplinapp.org/donate/#donations"><img src="https://raw.githubusercontent.com/laurent22/joplin/dev/Assets/WebsiteAssets/images/badges/Donate-IBAN.svg" alt="Donate using IBAN"></a></p>
</div>
<h1>Improving the sync process in Joplin<a name="improving-the-sync-process-in-joplin" href="#improving-the-sync-process-in-joplin" class="heading-anchor">ğŸ”—</a></h1>
<p>The latest version of Joplin includes a mechanism to upgrade the Â structure of a sync target. When you startup the app you will be asked Â to upgrade before being able to sync. Once you start the process, the Â app will briefly display an information screen, upgrade the sync target, Â and then restart the app. Youâ€™ll then be able to sync with the new sync Â target format. That first upgrade is quite simple as the goal for now Â is to put the mechanism in place and verify that it works well.</p>
<p>From a user perspective this feature doesnâ€™t do anything visible, although <a href="https://github.com/laurent22/joplin/issues/3692#issuecomment-685679213">it caused some issues</a>, so one might wonder why itâ€™s even there. This post is meant to clarify this.</p>
<p>The structure of the sync target hasnâ€™t really changed since the day Â Joplin was released. It works well however it has some shortcomings that Â should be fixed eventually for sync to remain performant.</p>
<p>There are also various improvements that could be made but were not Â previously possible due to the lack of an upgrade mechanism. I have Â listed below the 5 main limitations or issues with the current sync Â process and how they could be fixed:</p>
<h3>No upper limit on the number of items<a name="no-upper-limit-on-the-number-of-items" href="#no-upper-limit-on-the-number-of-items" class="heading-anchor">ğŸ”—</a></h3>
<p>Joplinâ€™s UI works well even with millions of notes, however the sync Â target will keep getting slower and slower as more files are added to Â it. File systems often have a limit to the number of files they can Â support in a directory. One user also has reached <a href="https://discourse.joplinapp.org/t/limit-on-the-number-of-child-items-was-reached/3804">the limit of 150,000 items on OneDrive</a>.</p>
<p>For now, this is not a big issue because most users donâ€™t have Â millions of items, but as more web pages are being clipped (clipped Â pages often contain many small resources and images) and more note Â revisions are created (one note can have hundreds of revisions), this Â issue might start affecting more users.</p>
<p>One way to solve this issue would be to split the sync items into Â multiple directories. For example if we split the main directory into Â 100 sub-directories, it will be possible to have 15,000,000 OneDrive Â items instead of 150,000. Another way would be to support note Â archiving, as described below. How exactly weâ€™ll handle this problem is Â still to be defined, but there are certainly ways.</p>
<h3>Not possible to prioritise downloads<a name="not-possible-to-prioritise-downloads" href="#not-possible-to-prioritise-downloads" class="heading-anchor">ğŸ”—</a></h3>
<p>Currently, when syncing, the items are downloaded in a random way. So Â it might download some notes, then some tags and notebooks, then back Â to downloading notes, etc. For small sync operations it doesnâ€™t matter, Â but large ones, like when setting up a new device, it is very Â inefficient. For example, the app might download hundreds of note Â revisions or tags, but wonâ€™t display anything for a while because it Â wonâ€™t have downloaded notebooks or notes.</p>
<p>A simple improvement would be to group the items by type on the sync Â target. So all notebook items together, all tags together, etc. Doing so Â means when syncing we can first download the notebooks, then the notes, Â which means something will be displayed almost immediately in the app, Â allowing the user to start using it. Then later less important items Â like tags or note revisions will be downloaded.</p>
<h3>End-to-end encryption is hard to setup<a name="end-to-end-encryption-is-hard-to-setup" href="#end-to-end-encryption-is-hard-to-setup" class="heading-anchor">ğŸ”—</a></h3>
<p>Currently, the encryption settings is a property of the clients. What Â it means it that when you setup a new client, it doesnâ€™t know whether Â the other clients use encryption or not. Itâ€™s going to guess more or Â less based on the data on the sync target. You can also force it to use Â encryption but this has drawbacks and often mean a new master key is Â going to be created, even though there might already be one on the sync Â target.</p>
<p>E2EE works well once itâ€™s setup, but doing so can be tricky and possibly confusing - if you didnâ€™t follow <a href="https://joplinapp.org/e2ee/">this guide</a> to the letter, you might end up with multiple master keys, or sending decrypted notes to an encrypted target.</p>
<p>A way to solve this would be to make the E2EE settings a property of Â the sync target. Concretely there would be a file that tells if E2EE is Â enabled or not, and maybe some way to quickly get the master key. It Â would simplify setting up encryption a lot and make it more secure Â (because you wonâ€™t be able to send non-encrypted notes to an encrypted Â sync target). When you setup a new client, the client will know Â immediately if itâ€™s an encrypted target or not and set the client Â accordingly.</p>
<h3>Old notes that never change should be handled differently<a name="old-notes-that-never-change-should-be-handled-differently" href="#old-notes-that-never-change-should-be-handled-differently" class="heading-anchor">ğŸ”—</a></h3>
<p>It would be more efficient to treat old notes differently by allowing Â the user to â€œarchiveâ€ them. An archived note would be read-only. Then Â one idea could be to group all these archived notes into a ZIP file on Â the sync target. Doing so means that the initial sync would be much Â faster (instead of downloading hundred of small files, which is slow, it Â will download one large file, which is fast). It would also make the Â structure more scalable - you could keep several years of archived notes Â on the sync target while keeping sync fast and efficient.</p>
<h3>The resource directory should be renamed<a name="the-resource-directory-should-be-renamed" href="#the-resource-directory-should-be-renamed" class="heading-anchor">ğŸ”—</a></h3>
<p>The folder that contains file attachments is named â€œ.resourcesâ€ on Â the sync target. This causes troubles because certain platforms will Â hide directories that start with dot â€œ.â€, and perhaps they will be Â excluded from backup or skipped when moved somewhere else. Being able to Â upgrade the sync target means we can rename this folder to just Â â€œresourcesâ€ instead.</p>
<h3>Conclusion<a name="conclusion" href="#conclusion" class="heading-anchor">ğŸ”—</a></h3>
<p>Thatâ€™s obviously a lot of possible improvements and it wonâ€™t be done Â overnight, but having the sync upgrade mechanism in place means we can Â start considering these options. Some of these, such as renaming the Â â€œresourcesâ€ dir are simpler and could be done relatively soon. Perhaps Â other more complex ones will be group within one sync target upgrade to Â minimise disruption. In any case, I hope this clarifies the reason for Â this recent sync upgrade and that it gives some ideas of what to expect Â in the future.</p>

								<div class="bottom-links">
									<a href="https://github.com/laurent22/joplin/blob/dev/readme/news/20200906-172325.md">
										<i class="fab fa-github"></i> Improve this doc
									</a>
								</div>
						</div>
					</div>
				</div>
			</div>

			
<footer class="darkblue-bg">
	<div class="container">
		<div class="row">
			<div class="col-12 col-md-12 social-links">
				<a href="https://twitter.com/joplinapp" title="Joplin Twitter feed"><i class="fab fa-twitter"></i></a>
				<a href="https://mastodon.social/@joplinapp" title="Joplin Mastodon feed"><i class="fab fa-mastodon"></i></a>
				<a href="https://www.patreon.com/joplin" title="Joplin Patreon"><i class="fab fa-patreon"></i></a>
				<a href="https://discord.gg/VSj7AFHvpq" title="Joplin Discord chat"><i class="fab fa-discord"></i></a>
				<a href="https://www.reddit.com/r/joplinapp/" title="Joplin Subreddit"><i class="fab fa-reddit"></i></a>
				<a href="https://github.com/laurent22/joplin/" title="Joplin GitHub repository"><i class="fab fa-github"></i></a>
			</div>
		</div>

		<div class="row bottom-links-row">
			<div class="col-12 col-md-6">
				<p class="text-center-sm">Copyright &copy; 2016-2021 Laurent Cozic</p>
			</div>
			<div class="col-12 col-md-6">
				<p class="text-right text-center-sm right-links">
					<span class="footer-right">
						<a href="/privacy/">Privacy Policy</a>
					</span>
				</p>
			</div>
		</div>
	</div>
</footer>		</div>

		<script src="/js/script.js?h=46b3b58d72c94591621551affbb8c6e3"></script>

<script>
	if (window.location.hostname !== 'localhost') {
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-103586105-1', 'auto');
		ga('send', 'pageview');
	}
</script>	</body>
</html>
